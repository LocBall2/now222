-- Mobile-Compatible Fractucul-Style AutoJoiner
-- Pure script solution - no external program needed
-- Usage: Execute with _G.DISCORD_TOKEN = "your_token_here"

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer

-- Discord configuration
local DISCORD_TOKEN = _G.DISCORD_TOKEN or ""
local DISCORD_GATEWAY = "wss://gateway.discord.gg/?v=10&encoding=json"

-- Chilli Hub channels to monitor
local CHILLI_HUB_CHANNELS = {
    "1394958052536619059", -- under_500k
    "1394958062166474823", -- 500k_1m  
    "1400302142702751864", -- 500k_1m (alt)
    "1399474388105035988", -- 1m-10m
    "1400302392431349770", -- 1m-10m (alt)
    "1399474419038032024", -- 10m_plus
}

-- Create main UI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FractuculAutoJoiner"
screenGui.Parent = CoreGui
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main container
local mainContainer = Instance.new("Frame")
mainContainer.Name = "MainContainer"
mainContainer.Size = UDim2.new(0, 380, 0, 250)
mainContainer.Position = UDim2.new(0.05, 0, 0.65, 0)
mainContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
mainContainer.BorderSizePixel = 0
mainContainer.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainContainer

-- Title bar
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainContainer

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 8)
titleCorner.Parent = titleBar

local title = Instance.new("TextLabel")
title.Name = "Title"
title.Size = UDim2.new(1, -40, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Text = "Fractucul AutoJoiner"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = titleBar

-- Close button
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 30, 1, 0)
closeButton.Position = UDim2.new(1, -30, 0, 0)
closeButton.BackgroundTransparency = 1
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 14
closeButton.Parent = titleBar

closeButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

-- Status panel
local statusPanel = Instance.new("Frame")
statusPanel.Name = "StatusPanel"
statusPanel.Size = UDim2.new(1, -20, 0, 30)
statusPanel.Position = UDim2.new(0, 10, 0, 40)
statusPanel.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
statusPanel.BorderSizePixel = 0
statusPanel.Parent = mainContainer

local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 6)
statusCorner.Parent = statusPanel

local statusLabel = Instance.new("TextLabel")
statusLabel.Name = "StatusLabel"
statusLabel.Size = UDim2.new(1, -10, 1, 0)
statusLabel.Position = UDim2.new(0, 10, 0, 0)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "Status: Ready"
statusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextSize = 12
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.Parent = statusPanel

-- Toggle button
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(1, -20, 0, 40)
toggleButton.Position = UDim2.new(0, 10, 0, 80)
toggleButton.BackgroundColor3 = Color3.fromRGB(60, 160, 60)
toggleButton.BorderSizePixel = 0
toggleButton.Text = "START AUTOJOINER"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Font = Enum.Font.GothamBold
toggleButton.TextSize = 14
toggleButton.Parent = mainContainer

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 6)
toggleCorner.Parent = toggleButton

-- Stats panel
local statsPanel = Instance.new("Frame")
statsPanel.Name = "StatsPanel"
statsPanel.Size = UDim2.new(1, -20, 0, 80)
statsPanel.Position = UDim2.new(0, 10, 0, 130)
statsPanel.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
statsPanel.BorderSizePixel = 0
statsPanel.Parent = mainContainer

local statsCorner = Instance.new("UICorner")
statsCorner.CornerRadius = UDim.new(0, 6)
statsCorner.Parent = statsPanel

local serversLabel = Instance.new("TextLabel")
serversLabel.Name = "ServersLabel"
serversLabel.Size = UDim2.new(0.5, -5, 0.5, -5)
serversLabel.Position = UDim2.new(0, 10, 0, 10)
serversLabel.BackgroundTransparency = 1
serversLabel.Text = "Servers: 0"
serversLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
serversLabel.Font = Enum.Font.Gotham
serversLabel.TextSize = 12
serversLabel.TextXAlignment = Enum.TextXAlignment.Left
serversLabel.Parent = statsPanel

local moneyLabel = Instance.new("TextLabel")
moneyLabel.Name = "MoneyLabel"
moneyLabel.Size = UDim2.new(0.5, -5, 0.5, -5)
moneyLabel.Position = UDim2.new(0.5, 5, 0, 10)
moneyLabel.BackgroundTransparency = 1
moneyLabel.Text = "Money: $0"
moneyLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
moneyLabel.Font = Enum.Font.Gotham
moneyLabel.TextSize = 12
moneyLabel.TextXAlignment = Enum.TextXAlignment.Left
moneyLabel.Parent = statsPanel

local lastServerLabel = Instance.new("TextLabel")
lastServerLabel.Name = "LastServerLabel"
lastServerLabel.Size = UDim2.new(1, -20, 0.5, -5)
lastServerLabel.Position = UDim2.new(0, 10, 0.5, 5)
lastServerLabel.BackgroundTransparency = 1
lastServerLabel.Text = "Last: None"
lastServerLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
lastServerLabel.Font = Enum.Font.Gotham
lastServerLabel.TextSize = 12
lastServerLabel.TextXAlignment = Enum.TextXAlignment.Left
lastServerLabel.Parent = statsPanel

-- AutoJoiner logic
local isRunning = false
local serversJoined = 0
local totalMoney = 0
local minMoney = 10 -- Minimum 10M/s
local maxPlayers = 7 -- Don't join if 7/8 or 8/8
local discordConnected = false
local websocket = nil

-- Check if token is provided
if DISCORD_TOKEN == "" then
    statusLabel.Text = "Error: Execute with _G.DISCORD_TOKEN"
else
    statusLabel.Text = "Token found! Ready to start"
end

-- Function to parse money from string
local function parseMoney(moneyStr)
    if not moneyStr then return 0 end
    local cleanStr = string.gsub(moneyStr, "[^%d%.]", "")
    if string.find(moneyStr, "K") then
        return tonumber(cleanStr) * 1000
    elseif string.find(moneyStr, "M") then
        return tonumber(cleanStr) * 1000000
    else
        return tonumber(cleanStr) or 0
    end
end

-- Function to extract server info from Discord message
local function extractServerInfo(message)
    local info = {
        name = "Unknown",
        money = 0,
        players = "0/8",
        jobId = nil
    }
    
    -- Look for money pattern
    local moneyMatch = string.match(message, "üí∞ Money per sec[^%d]*(%d+%.?%d*[MK]?)")
    if not moneyMatch then
        moneyMatch = string.match(message, "Money per sec[^%d]*(%d+%.?%d*[MK]?)")
    end
    if moneyMatch then
        info.money = parseMoney(moneyMatch)
    end
    
    -- Look for players pattern
    local playersMatch = string.match(message, "üë• Players[^%d]*(%d+/%d+)")
    if not playersMatch then
        playersMatch = string.match(message, "Players[^%d]*(%d+/%d+)")
    end
    if playersMatch then
        info.players = playersMatch
    end
    
    -- Look for server name
    local nameMatch = string.match(message, "üè∑Ô∏è Name[^\n]-%*([^%*]+)%*")
    if not nameMatch then
        nameMatch = string.match(message, "Name[^\n]-%*([^%*]+)%*")
    end
    if nameMatch then
        info.name = nameMatch
    end
    
    -- Look for Job ID (PC) - most important
    local jobIdMatch = string.match(message, "Job ID %(PC%)[^\n]-%`([^%`]+)%`")
    if not jobIdMatch then
        jobIdMatch = string.match(message, "Job ID %(PC%)[^\n]-([%w%=]+)")
    end
    if not jobIdMatch then
        jobIdMatch = string.match(message, "7IRZ[%w=]+") -- Common Chilli Hub pattern
    end
    if jobIdMatch then
        info.jobId = jobIdMatch
    end
    
    return info
end

-- Function to connect to Discord Gateway directly
local function connectToDiscordGateway()
    if DISCORD_TOKEN == "" then
        statusLabel.Text = "Error: No Discord token"
        return false
    end
    
    statusLabel.Text = "Connecting to Discord..."
    
    -- This is a simplified Discord Gateway connection
    -- Note: Real implementation would require proper WebSocket handling
    
    local success, ws = pcall(function()
        return WebSocket.connect(DISCORD_GATEWAY)
    end)
    
    if success and ws then
        websocket = ws
        statusLabel.Text = "Connected to Discord Gateway!"
        
        -- Send identify payload
        local identifyPayload = {
            op = 2,
            d = {
                token = DISCORD_TOKEN,
                properties = {
                    os = "Windows",
                    browser = "Chrome", 
                    device = ""
                },
                intents = 513 -- GUILD_MESSAGES + MESSAGE_CONTENT
            }
        }
        
        local success, err = pcall(function()
            websocket:Send(HttpService:JSONEncode(identifyPayload))
        end)
        
        if not success then
            statusLabel.Text = "Failed to identify: " .. tostring(err)
            return false
        end
        
        -- Listen for messages
        websocket.OnMessage:Connect(function(message)
            if isRunning then
                local success, data = pcall(function()
                    return HttpService:JSONDecode(message)
                end)
                
                if success and data then
                    -- Handle Discord Gateway events
                    if data.t == "MESSAGE_CREATE" then
                        local channelId = data.d.channel_id
                        local content = data.d.content
                        
                        -- Check if message is from monitored channel
                        for _, monitoredChannel in ipairs(CHILLI_HUB_CHANNELS) do
                            if channelId == monitoredChannel then
                                -- Extract server info from message
                                local serverInfo = extractServerInfo(content)
                                if serverInfo.jobId then
                                    joinJobInstantly(serverInfo.jobId, serverInfo.money, serverInfo.players, serverInfo.name)
                                end
                                break
                            end
                        end
                    end
                end
            end
        end)
        
        websocket.OnClose:Connect(function()
            statusLabel.Text = "Discord connection closed"
            websocket = nil
            if isRunning then
                wait(3)
                connectToDiscordGateway()
            end
        end)
        
        return true
    else
        statusLabel.Text = "Failed to connect to Discord"
        return false
    end
end

-- Function to join a job instantly
local function joinJobInstantly(jobId, money, players, serverName)
    if not jobId or jobId == "" or #jobId < 30 then
        statusLabel.Text = "Invalid Job ID"
        return false
    end
    
    -- Check if server meets criteria
    local moneyValue = parseMoney(money)
    local currentPlayers = tonumber(string.match(players, "(%d+)/")) or 0
    
    if moneyValue < minMoney * 1000000 then
        statusLabel.Text = "Skipped: Money too low (" .. money .. ")"
        return false
    end
    
    if currentPlayers >= maxPlayers then
        statusLabel.Text = "Skipped: Server full (" .. players .. ")"
        return false
    end
    
    -- Join the server instantly
    statusLabel.Text = "Joining " .. (serverName or "server") .. "..."
    lastServerLabel.Text = "Last: " .. (serverName or "Unknown")
    
    -- Use Roblox's TeleportService to join the server
    local success, result = pcall(function()
        TeleportService:TeleportToPlaceInstance(game.PlaceId, jobId, player)
    end)
    
    if success then
        serversJoined = serversJoined + 1
        totalMoney = totalMoney + moneyValue
        serversLabel.Text = "Servers: " .. serversJoined
        moneyLabel.Text = "Money: $" .. totalMoney
        statusLabel.Text = "Joined successfully!"
        return true
    else
        statusLabel.Text = "Failed to join: Server unavailable"
        return false
    end
end

-- Toggle button functionality
toggleButton.MouseButton1Click:Connect(function()
    if DISCORD_TOKEN == "" then
        statusLabel.Text = "Error: Execute with _G.DISCORD_TOKEN"
        return
    end
    
    isRunning = not isRunning
    
    if isRunning then
        toggleButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
        toggleButton.Text = "STOP AUTOJOINER"
        connectToDiscordGateway()
    else
        toggleButton.BackgroundColor3 = Color3.fromRGB(60, 160, 60)
        toggleButton.Text = "START AUTOJOINER"
        if websocket then
            websocket:Close()
            websocket = nil
        end
        statusLabel.Text = "Stopped - Ready"
    end
end)

-- Make the window draggable
local dragging
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    mainContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainContainer.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

titleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Initial setup
statusLabel.Text = "Ready - Start AutoJoiner"
serversLabel.Text = "Servers: 0"
moneyLabel.Text = "Money: $0"
lastServerLabel.Text = "Last: None"

print("Fractucul-Style AutoJoiner loaded!")
print("This is a pure script solution - no external programs needed")
print("Make sure to execute with your Discord token")
print("Click START AUTOJOINER to begin monitoring Discord channels")
